---
alwaysApply: false
description: Zionå¹³å°ä»£ç ç»„ä»¶æ ¸å¿ƒè§„èŒƒï¼Œå®šä¹‰æ–‡ä»¶ç»“æ„ã€å¯¼å‡ºè§„èŒƒã€ä¸‰æ®µå¼æ¥å£æ ‡å‡†
---

# Zion ä»£ç ç»„ä»¶æ ¸å¿ƒè§„èŒƒ

## ğŸ—ï¸ å¹³å°æ¶æ„åŸåˆ™

Zionä½œä¸ºå…¨æ ˆæ— ä»£ç å¼€å‘å¹³å°ï¼Œæ¯ä¸ªé¡¹ç›®æ‹¥æœ‰ç‹¬ç«‹çš„å‰ç«¯ï¼ˆReactï¼‰å’Œåç«¯ï¼Œé€šè¿‡GraphQL APIé€šä¿¡ã€‚ä»£ç ç»„ä»¶å…è®¸å¼€å‘è€…æ‰©å±•å¹³å°ç»„ä»¶åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŸåˆ™
1. **å…¨éƒ¨ä½¿ç”¨React**: æ‰€æœ‰ç»„ä»¶å¿…é¡»é‡‡ç”¨Reactå®ç°
2. **ä¸¥æ ¼éµå¾ªpropsåè®®**: propsæ˜¯å”¯ä¸€é€šä¿¡æ¸ é“ï¼Œè§†ä¸ºåªè¯»
3. **æ•°æ®åº“ç»“æ„å¿…é¡»è‡ªåŠ¨è·å–**: é€šè¿‡MCPå·¥å…·åŒæ­¥schema
4. **æ™ºèƒ½é¡¹ç›®æ£€æµ‹**: é¿å…æ— è„‘åˆ›å»ºæ–°é¡¹ç›®å¯¼è‡´ç›®å½•æ··ä¹±
5. **ä¸‰æ®µå¼ç±»å‹å¯¼å‡º**: PropDataã€StateDataã€Eventã€Propså››ä¸ªinterface
6. **åç«¯é€šä¿¡ç»Ÿä¸€é€šè¿‡query**: GraphQLæŸ¥è¯¢å­˜æ”¾åœ¨.gqlæ–‡ä»¶ä¸­
7. **äºŒè¿›åˆ¶èµ„æºéµå¾ªä¸“ç”¨åè®®**: å›¾ç‰‡ã€è§†é¢‘ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹

## ğŸ“ æ–‡ä»¶ä¸ç›®å½•è§„èŒƒ

### ç›®å½•ç»“æ„æ ‡å‡†

```
[Zioné¡¹ç›®æ ¹ç›®å½•]/
â”œâ”€â”€ package.json                       # é¡¹ç›®é…ç½®ï¼ˆé¡¹ç›®æ£€æµ‹æ ‡å¿—ï¼‰
â”œâ”€â”€ src/                               # æºä»£ç ç›®å½•ï¼ˆé¡¹ç›®æ£€æµ‹æ ‡å¿—ï¼‰
â”‚   â”œâ”€â”€ components/                    # ç»„ä»¶æ€»ç›®å½•ï¼ˆé¡¹ç›®æ£€æµ‹æ ‡å¿—ï¼‰
â”‚   â”‚   â”œâ”€â”€ UserForm/                  # ç»„ä»¶UserForm
â”‚   â”‚   â”‚   â”œâ”€â”€ UserForm.tsx           # ä¸»æ–‡ä»¶ï¼Œå¿…é¡»åŒå
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts               # èšåˆå¯¼å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts               # ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ style.module.scss      # æ ·å¼æ–‡ä»¶ï¼ˆCSS Modulesï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ graphql/               # GraphQLæŸ¥è¯¢ç›®å½•
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ userQuery.gql      # GraphQLæ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ README.md              # ç»„ä»¶æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ UserInfo/                  # ç»„ä»¶UserInfo
â”‚   â”‚   â””â”€â”€ index.ts                   # ç»„ä»¶åº“ä¸»å…¥å£
â”‚   â””â”€â”€ App.tsx                        # é¡¹ç›®ä¸»å…¥å£
```

### æ ¸å¿ƒè§„èŒƒ
1. **æ¯ä¸ªç»„ä»¶å•ç‹¬æ–‡ä»¶å¤¹**: æ‰€æœ‰ç»„ä»¶åœ¨`src/components/`ä¸‹å¹³çº§ç®¡ç†
2. **ä¸»æ–‡ä»¶åŒå**: `UserInfo/UserInfo.tsx`ï¼Œç¦ç”¨`index.tsx`ä½œä¸ºå®ç°æ–‡ä»¶
3. **GraphQLæ–‡ä»¶ç»Ÿä¸€ç®¡ç†**: æ”¾åœ¨ç»„ä»¶ç›®å½•ä¸‹çš„`graphql/`å­ç›®å½•
4. **å¹³çº§ç®¡ç†**: ä¸å­˜åœ¨å¤§ç»„ä»¶å°ç»„ä»¶æ¦‚å¿µï¼Œé¿å…åµŒå¥—ç»“æ„

## ğŸ“¤ å¯¼å‡ºä¸å¯¼å…¥è§„èŒƒ

### å¯¼å‡ºè§„èŒƒ
1. **ç¦æ­¢export default**: ä¸»æ–‡ä»¶æ‰€æœ‰å†…å®¹å¿…é¡»å…·åå¯¼å‡º
2. **ä¸‰æ®µå¼ç±»å‹å¿…é¡»åœ¨ä¸»æ–‡ä»¶å¯¼å‡º**: ä¸èƒ½åœ¨types.tsæˆ–index.tså¯¼å‡º
3. **ç»„ä»¶ç›®å½•index.ts**: åªåšèšåˆå¯¼å‡º `export * from './ç»„ä»¶å'`
4. **ä¸»å…¥å£å¯¹è±¡å¯¼å‡º**: `src/components/index.ts`ç”¨å¯¹è±¡æ–¹å¼å¯¼å‡ºæ‰€æœ‰ç»„ä»¶

### ä»£ç ç¤ºä¾‹

```typescript
// ./src/components/UserInfo/UserInfo.tsx
import React from 'react';
import { EventHandler, State } from 'zvm-code-context';

// ä¸‰æ®µå¼ç±»å‹å¿…é¡»åœ¨ä¸»æ–‡ä»¶å¯¼å‡º
export interface UserInfoPropData {
  name: string;
  age: number;
  isActive: boolean;
}

export interface UserInfoStateData {
  loading: State<boolean>;
  errorMsg: State<string>;
}

export interface UserInfoEvent {
  onConfirm?: EventHandler;
  onCancel?: EventHandler;
}

export interface UserInfoProps {
  propData: UserInfoPropData;
  propState: UserInfoStateData;
  event: UserInfoEvent;
}

// ç»„ä»¶æœ¬ä½“å…·åå¯¼å‡º
export const UserInfo = (props: UserInfoProps) => {
  // ç»„ä»¶å®ç°
};
```

```typescript
// ./src/components/UserInfo/index.ts
export * from './UserInfo';
```

```typescript
// ./src/components/index.ts
import { UserForm } from './UserForm';
import { UserInfo } from './UserInfo';
export default {
  UserForm,
  UserInfo,
};
```

## ğŸ”§ ä¸‰æ®µå¼ä»£ç è§„èŒƒ

### å››ä¸ªå¿…éœ€Interface

1. **PropDataè§„èŒƒ**
   - ä»…ç”¨äºå¹³å°å‘ç»„ä»¶ä¼ é€’æ•°æ®ï¼ˆå•å‘è¾“å…¥ï¼‰
   - å­—æ®µç±»å‹**å¿…é¡»ä¸º**: `string`ã€`number`ã€`boolean`
   - **ç¦æ­¢ä½¿ç”¨**: æ•°ç»„ã€å¯¹è±¡ã€è”åˆç±»å‹ã€State<T>ç­‰

2. **StateDataè§„èŒƒ**
   - ä»…ç”¨äºç»„ä»¶å‘å¹³å°å›ä¼ æ•°æ®ï¼ˆåŒå‘ç»‘å®šï¼‰
   - å­—æ®µç±»å‹**å¿…é¡»ä¸º**: `State<T>`ï¼ˆå¦‚State<number>ã€State<string>ï¼‰
   - **ç¦æ­¢ä½¿ç”¨**: åŸºç¡€ç±»å‹æˆ–å…¶ä»–å¤æ‚ç±»å‹

3. **Eventè§„èŒƒ**
   - ä»…ç”¨äºå£°æ˜ç»„ä»¶å¯¹å¤–å¯è§¦å‘çš„äº‹ä»¶
   - å­—æ®µç±»å‹**å¿…é¡»ä¸º**: å¹³å°æä¾›çš„`EventHandler`
   - **ç¦æ­¢ä½¿ç”¨**: è‡ªå®šä¹‰å‡½æ•°ç±»å‹

4. **Propsè§„èŒƒ**
   - å¿…é¡»åŒ…å«propDataã€propStateã€eventä¸‰ä¸ªå­—æ®µ

### å‘½åè§„èŒƒ
ä¸¥æ ¼éµå¾ªï¼š`ç»„ä»¶åPropData`ã€`ç»„ä»¶åStateData`ã€`ç»„ä»¶åEvent`ã€`ç»„ä»¶åProps`

### å¸¸è§é”™è¯¯ï¼ˆç¦æ­¢ï¼‰
```typescript
// âŒ PropDataé”™è¯¯ç¤ºä¾‹
export interface WrongPropData {
  tags: string[];            // ç¦æ­¢ï¼šæ•°ç»„
  options: { a: string };    // ç¦æ­¢ï¼šå¯¹è±¡
  type: 'A' | 'B';           // ç¦æ­¢ï¼šè”åˆç±»å‹
  result: State<number>;     // ç¦æ­¢ï¼šState<T>
}

// âŒ StateDataé”™è¯¯ç¤ºä¾‹
export interface WrongStateData {
  loading: boolean;          // ç¦æ­¢ï¼šåŸºç¡€ç±»å‹
  data: number[];            // ç¦æ­¢ï¼šæ•°ç»„
}

// âŒ Eventé”™è¯¯ç¤ºä¾‹
export interface WrongEvent {
  onChange: (val: string) => void; // ç¦æ­¢ï¼šè‡ªå®šä¹‰å‡½æ•°ç±»å‹
}
```

## ğŸ”— å¹³å°APIä½¿ç”¨è§„èŒƒ

### æ ¸å¿ƒçº¦æŸ
1. **æ‰€æœ‰å¹³å°APIå¿…é¡»é€šè¿‡useAppContext()è·å–ctx**
2. **ç¦æ­¢ç›´æ¥æ“ä½œwindowã€locationã€å…¨å±€å˜é‡**
3. **GraphQLè¯·æ±‚å¿…é¡»ç”¨ctx.query(gql.loc.source.body, params)**
4. **é¡µé¢è·³è½¬å¿…é¡»ç”¨ctx.navigate**

### æ ‡å‡†ç”¨æ³•
```typescript
import { useAppContext } from 'zvm-code-context';
import userListQuery from './graphql/userListQuery.gql';

const ctx = useAppContext();

// GraphQLè¯·æ±‚
const res = await ctx.query(userListQuery.loc.source.body, { page: 1 });
const users = res?.data?.userList;

// é¡µé¢è·³è½¬
ctx.navigate('/user/123', { params: { id: 123 } });

// è·å–å…¨å±€æ•°æ®
const theme = ctx.globalData.theme;
const user = ctx.globalData.currentUser;
```

## âš›ï¸ React Hooksè§„èŒƒ

### useCallbackè§„èŒƒ
1. **ç¦æ­¢åœ¨ä¾èµ–æ•°ç»„ä¸­åŒ…å«stateå˜é‡**
2. **ä¾èµ–æ•°ç»„åªèƒ½åŒ…å«**: ctxã€å›ºå®šé…ç½®å€¼ã€propsä¼ å…¥çš„å›ºå®šå€¼
3. **æ•°æ®åŠ è½½å‡½æ•°å¿…é¡»æ¥å—å‚æ•°**
4. **ç¦æ­¢ä½¿ç”¨å¯¹è±¡ä¾èµ–**ï¼ˆå¦‚propDataã€propStateã€eventï¼‰å¯¼è‡´æ— é™æ¸²æŸ“

### useEffectè§„èŒƒ
1. **åˆå§‹åŒ–æ•°æ®åŠ è½½å¿…é¡»ä½¿ç”¨ç©ºä¾èµ–æ•°ç»„**
2. **çŠ¶æ€åŒæ­¥useEffectå¿…é¡»ä½¿ç”¨ç©ºä¾èµ–æ•°ç»„**
3. **ç¦æ­¢ç›´æ¥ä¾èµ–propState**
4. **åªä½¿ç”¨åŸºæœ¬ç±»å‹ä¾èµ–**ï¼ˆå¦‚isListeningã€isSupportedï¼‰

### æ ‡å‡†æ¨¡å¼
```typescript
// âœ… æ­£ç¡®çš„useCallback
const loadData = useCallback(async (page: number = 1, keyword?: string) => {
  const res = await ctx.query(query.loc.source.body, {
    limit: pageSize,
    offset: (page - 1) * pageSize,
    where: keyword ? { name: { _ilike: `%${keyword}%` } } : {}
  });
}, [ctx, pageSize]); // åªä¾èµ–å›ºå®šå€¼

// âœ… æ­£ç¡®çš„useEffect
useEffect(() => {
  loadData(1); // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ
}, []); // ç©ºä¾èµ–æ•°ç»„

// âœ… æ­£ç¡®ï¼šåªä½¿ç”¨åŸºæœ¬ç±»å‹ä¾èµ–
useEffect(() => {
  // é€»è¾‘
}, [isListening, isSupported]); // åŸºæœ¬ç±»å‹

// âŒ é”™è¯¯ï¼šä½¿ç”¨å¯¹è±¡ä¾èµ–
useEffect(() => {
  // é€»è¾‘
}, [propData, propState, event]); // å¯¹è±¡ä¾èµ–å¯¼è‡´æ— é™æ¸²æŸ“

// å¿…è¦æ—¶ä½¿ç”¨eslint-disable
useCallback(() => {
  // é€»è¾‘
  // eslint-disable-next-line react-hooks/exhaustive-deps
}, [isListening]);
```

## ğŸ“‹ æ¥å£å®šä¹‰è§„èŒƒ

### PropDataæ¥å£è§„èŒƒ
1. **æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¿…éœ€çš„**ï¼ˆç¦æ­¢å¯é€‰å±æ€§`?`ï¼‰
2. **å±æ€§ç±»å‹é™åˆ¶**: åªèƒ½ä½¿ç”¨`string`ã€`number`ã€`boolean`
3. **ä½¿ç”¨é©¼å³°å‘½åæ³•**ï¼Œåç§°å…·æœ‰æ˜ç¡®è¯­ä¹‰

### StateDataæ¥å£è§„èŒƒ
1. **æ‰€æœ‰å±æ€§å¿…é¡»ä½¿ç”¨State<T>ç±»å‹**
2. **State<T>æ³›å‹å‚æ•°**: åªèƒ½ä½¿ç”¨å…·ä½“ç±»å‹ï¼Œä¸èƒ½ä½¿ç”¨è”åˆç±»å‹æˆ–null

### æ•°æ®æ¨¡å‹æ¥å£è§„èŒƒ
1. **ç¦æ­¢åµŒå¥—å¯é€‰å¯¹è±¡**: æ‰€æœ‰åµŒå¥—å¯¹è±¡å¿…é¡»æ‰å¹³åŒ–
2. **ç¦æ­¢ä½¿ç”¨anyç±»å‹**: ä½¿ç”¨stringæ›¿ä»£any
3. **ç¦æ­¢ä½¿ç”¨nullç±»å‹**: ä½¿ç”¨ç©ºå­—ç¬¦ä¸²æˆ–é»˜è®¤å€¼

### æ ‡å‡†å®šä¹‰ç¤ºä¾‹
```typescript
// âœ… æ­£ç¡®çš„PropData
export interface AccountManagerPropData {
  pageSize: number;           // å¿…éœ€å±æ€§
  searchKeyword: string;      // å¿…éœ€å±æ€§
  sortField: string;          // å¿…éœ€å±æ€§
}

// âœ… æ­£ç¡®çš„StateData
export interface AccountManagerStateData {
  currentPage: State<number>;     // State<T>ç±»å‹
  totalCount: State<number>;      // State<T>ç±»å‹
  accounts: State<Account[]>;     // State<T>ç±»å‹
}

// âœ… æ­£ç¡®çš„æ•°æ®æ¨¡å‹
export interface Account {
  id: string;                    // å…·ä½“ç±»å‹
  username: string;              // å…·ä½“ç±»å‹
  profile_image_url: string;     // æ‰å¹³åŒ–å¤„ç†
  fz_deleted: boolean;           // å…·ä½“ç±»å‹
}
```

## ğŸš¨ Reactçº¦æŸ

### å…³é”®çº¦æŸ
```typescript
// âœ… æ¯ä¸ª.tsxæ–‡ä»¶å¿…é¡»å¯¼å…¥React
import React from 'react';

// âŒ ç¦æ­¢æ‰‹åŠ¨external React
// external: ['react'] // ç¦æ­¢åœ¨vite.config.tsä¸­é…ç½®
```

### é—®é¢˜è§£å†³
- é—®é¢˜: `React is not defined`
- è§£å†³: ç¡®ä¿æ¯ä¸ª.tsxæ–‡ä»¶é¡¶éƒ¨å¯¼å…¥React
- ç¡®ä¿package.jsonä¸­Reactä¸ºdependenciesè€ŒédevDependencies

## ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥è§„èŒƒ

### propStateè®¿é—®å®‰å…¨
```typescript
// âœ… æ­£ç¡®ï¼šæ‰€æœ‰propStateè®¿é—®å¿…é¡»æœ‰nullæ£€æŸ¥
const value = propState.transcript ? (propState.transcript.get() || '') : '';
const length = value.length; // å®‰å…¨è®¿é—®

// âŒ é”™è¯¯ï¼šç›´æ¥è®¿é—®å¯èƒ½ä¸ºnullçš„å€¼
const value = propState.transcript.get(); // å¯èƒ½è¿”å›null
const length = value.length; // å¯èƒ½è®¿é—®nullçš„length
```

### å¤–éƒ¨APIè°ƒç”¨å®‰å…¨
```typescript
// âœ… æ­£ç¡®ï¼šAPIç»“æœå¿…é¡»æ£€æŸ¥
if (!result || !result.length) return;
for (let i = 0; i < result.length; i++) {
  if (!result[i]) continue;
  // å®‰å…¨å¤„ç†
}

// âŒ é”™è¯¯ï¼šç›´æ¥è®¿é—®APIç»“æœ
for (let i = 0; i < result.length; i++) {
  const item = result[i][0]; // å¯èƒ½è®¿é—®null
}
```

## ğŸ¨ æ ·å¼ç³»ç»Ÿè§„èŒƒ

### CSS Modulesä½¿ç”¨è§„èŒƒ
```typescript
// âœ… æ­£ç¡®ï¼šå¯¼å…¥å’Œä½¿ç”¨
import styles from './style.module.scss';
<div className={styles['container']}>
<div className={`${styles['button']} ${isActive ? styles.active : ''}`}>

// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨ç±»å
import './style.module.scss';
<div className="container">
```

**æ³¨æ„**: æ ·å¼æ–‡ä»¶å¿…é¡»ä½¿ç”¨`style.module.scss`å‘½åï¼Œç¡®ä¿CSS Modulesæ­£ç¡®å·¥ä½œã€‚

## âœ… å‘å¸ƒå‰æ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡æ£€æŸ¥
```bash
npx tsc --noEmit        # ç±»å‹æ£€æŸ¥
npm run lint            # ä»£ç è§„èŒƒæ£€æŸ¥
npm run build           # æ„å»ºæ£€æŸ¥
npm version patch       # ç‰ˆæœ¬ç®¡ç†
functorz publish --verbose  # å‘å¸ƒ
```

### å¼ºåˆ¶æ£€æŸ¥é¡¹
- [ ] æ‰€æœ‰PropDataå±æ€§éƒ½æ˜¯å¿…éœ€çš„ï¼ˆæ— `?`æ ‡è®°ï¼‰
- [ ] æ‰€æœ‰StateDataå±æ€§éƒ½ä½¿ç”¨`State<T>`ç±»å‹
- [ ] æ‰€æœ‰æ•°æ®æ¨¡å‹å­—æ®µéƒ½æœ‰å…·ä½“ç±»å‹ï¼ˆæ— `any`ã€`null`ï¼‰
- [ ] æ‰€æœ‰åµŒå¥—å¯¹è±¡éƒ½å·²æ‰å¹³åŒ–å¤„ç†
- [ ] æ‰€æœ‰useCallbackä¾èµ–éƒ½ä¸åŒ…å«stateå˜é‡
- [ ] æ‰€æœ‰useEffectåˆå§‹åŒ–éƒ½ä½¿ç”¨ç©ºä¾èµ–æ•°ç»„
- [ ] æ¯ä¸ª.tsxæ–‡ä»¶éƒ½å¯¼å…¥äº†React
- [ ] æ„å»ºå’Œç±»å‹æ£€æŸ¥æ— é”™è¯¯
- [ ] **æ‰€æœ‰propStateè®¿é—®éƒ½æœ‰nullæ£€æŸ¥**
- [ ] **æ‰€æœ‰å¤–éƒ¨APIè°ƒç”¨éƒ½æœ‰å®‰å…¨æ£€æŸ¥**
- [ ] **CSS Modulesä½¿ç”¨æ­£ç¡®**
- [ ] **React Hooksä¾èµ–æ•°ç»„è®¾ç½®æ­£ç¡®**

---

**æ³¨æ„**: æœ¬æ–‡ä»¶ä¸“æ³¨ä»£ç è§„èŒƒæ ‡å‡†ï¼ŒGraphQLè¯¦ç»†è§„èŒƒå’Œåª’ä½“ä¸Šä¼ åè®®è¯·å‚è€ƒGraphQLæŒ‡å—æ–‡ä»¶ã€‚